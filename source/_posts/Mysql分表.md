title: Mysql分表
author: Wtli
date: 2021-08-02 14:53:36
tags:
---
Mysql分库、分表。分表的实现。

最近使用mysql数据库，数据量太大，已经接近1个亿的数据。

单单是使用navicat切换到数据表的最后一页就要等好几分钟，更别说根据日期或者其他的字段进行数据查询。

解决方案：<font color = "grey"> 见详情 </font>

<!--more-->

#### 解决方案

解决思路，两个方向：

1. 换数据库，使用hbase或者其他数据量大的数据库。
2. 优化mysql，增加索引或者在软件硬件方向优化。

目前当前项目是轻量化部署，不考虑更换数据库，暂不使用hbase。<font color = "grey"> 尝试了一下hbase部署，不一定需要hadoop的hdfs的文集系统，感觉hbase是可以通过一台zookeeper轻量化部署在一台主机上的，仅作参考。 </font>

优化mysql解决方案：
1. 分库。
2. 分表。

对于分库分表的解释，网上有很多，什么水平、垂直分库分表，在这就不赘述了，仅针对我自己的项目来分析，并实现。

首先，轻量化部署，不考虑分库，只有一台主机，没必要进行分库。

考虑分表：

1. 垂直分表，将数据表的字段减少。
2. 水平分表，将表中数据拆分成多个表。

垂直分表，数据量基本能达到亿级的，所以垂直分表能对数据查询操作优化，但是效果基本还是达不到要求，垂直分表往往是伴随着水平分表来做的。

#### 水平分表

多种分表逻辑：

1. 按照项目自身逻辑分表，在我们项目中就是按照学习记录分表，一次学习记录相当于一次逻辑更新。
2. 按照数据数量进行分表，这是比较常用的一种方式。
3. 按照时间进行分表，以天为单位，或者其他为单位进行分表，不推荐。
4. 按照插入顺序分表，例如id为奇数时放在1表，为偶数时放在2表，不推荐。

分表常见问题：

1. 主键问题。
2. 查询时注意多表查询。
3. 服务器时间可靠的情况下再觉得使用服务器时间分表。

现在采用最基础的方式，按照数量进行分表，并实现。

#### 分表实现

说一下原因，结合项目查询操作的需求。因为查询操作目前用的比较多的是根据日期查询，所以在这里采用数量的方式进行分表，然后单独用一个表来存储表的数据时间即可。





















